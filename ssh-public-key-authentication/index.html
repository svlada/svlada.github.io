<!DOCTYPE html><html lang="en"><head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta property="og:type" content="website">
  <meta property="og:title" content="Public key authentication with Java over SSH">
  <meta property="og:site_name" content="Freelance Software Developer">
  <title>Public key authentication with Java over SSH</title>
  <meta name="description" content="This article shows how to securely connect (i.e. establish ssh connection) to the remote host from java application.">
  <meta name="author" content="Vlada Stankovic">

  <link rel="stylesheet" href="/css/prism-base16-ateliersulphurpool.light.css?v=1.0.2">

  <!-- <link rel="stylesheet" href="/css/index.css?v=1.8.8"> -->
  
  <link rel="stylesheet" href="https://unpkg.com/tachyons@4.12.0/css/tachyons.min.css">  
  <style>
    h1, h2, h3, h4, h5 { color: #aaf; }

    .direct-link { display: none; }
    a { color: #aaf; }
    /* main a:visited { color: #e8f; } */
    main article > h2 a:visited { color: #5e5e8c;}
  </style>
  <link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="Vladimir Stankovic - Software engineer">

  <script type="application/ld+json">
  {
      "@context": "http://schema.org/",
      "@type": "Person",
      "name": "Vladimir Stankovic",
      "alternateName": "Vlada, Svlada",
      "url": "https://www.svlada.com",
      "image": "",
      "sameAs": [
          "https://github.com/svlada",
          "https://twitter.com/svlada",
          "https://www.linkedin.com/in/svlada",
          "https://news.ycombinator.com/user?id=hawkweed"=
      ]
  }
  </script>
</head>

<body class="w-100 sans-serif center mw7 bg-washed-gray ">
  <header>
    <nav class="pt4 pl4 pr4 pb0 ">
      <a class="link b f5 f5-ns dib mr3" href="/" title="Vladimir Stankovic">~</a>
      <a class="link f5 f5-ns dib mr3" href="/about" title="About">About</a>
    </nav>
  </header>
  <main class="">
    <section class="pa3 pa4-ns">
<article class="lh-copy">
    <h1 class="f3 lh-copy">Public key authentication with Java over SSH</h1>
    <ol>
<li><a href="#introduction">Intro</a></li>
<li><a href="#generate-key-pair">Generate Key Pair</a></li>
<li><a href="#copy-public-key-to-remote-host">Copy public key to remote host</a></li>
<li><a href="#java-code">Connect to remote host from java</a></li>
<li><a href="#source-code">Source code</a></li>
</ol>
<h2 class="f4 lh-copy"><a name="introduction" id="introduction">Intro</a></h2>
<p>This article shows how to securely connect (i.e. establish ssh connection) to the remote host from java application. Also, configuration details for enabling public key authentication and protecting ssh keys will be provided.</p>
<p>Public key authentication enables users to establish an SSH connection without providing (i.e. typing in) explicit password. The immediate benefit is that the password is not transferred over the network, thus preventing the possibility of the password being compromised.</p>
<p>The private key should be stored in the ssh keychain and protected with the encryption passphrase.</p>
<h2 class="f4 lh-copy"><a name="generate-key-pair" id="generate-key-pair">Generate Key Pair</a></h2>
<p>The first step is to generate a private/public key on the server where your java application will be running.</p>
<p>Private/public key pair can be generated by executing the following command:</p>
<pre class="language-text"><code class="language-text">ssh-keygen -t rsa</code></pre>
<p>Here is the output from my local development box:</p>
<pre class="language-text"><code class="language-text">vladimir.stankovic@PCSVLADA ~
$ ssh-keygen -t rsa
Generating public/private rsa key pair.
Enter file in which to save the key (/home/vladimir.stankovic/.ssh/id_rsa):
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /home/vladimir.stankovic/.ssh/id_rsa.
Your public key has been saved in /home/vladimir.stankovic/.ssh/id_rsa.pub.</code></pre>
<p>Private key is identified as <code>id_rsa</code> and public key as a <code>id_rsa.pub</code>.</p>
<h2 class="f4 lh-copy"><a name="copy-public-key-to-remote-host" id="">Copy public key to remote host</a></h2>
<p>The <code>ssh-copy-id</code> copies the public key of your default identity (use -i identity_file for other identities) to the remote host.</p>
<pre class="language-text"><code class="language-text">vladimir.stankovic@PCSVLADA ~
$ ssh-copy-id -i /home/vladimir.stankovic/.ssh/id_rsa root@www.svlada.com
/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed
/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys
root@www.svlada.com's password:
Number of key(s) added: 1
Now try logging into the machine, with:   "ssh 'root@www.svlada.com'"
and check to make sure that only the key(s) you wanted were added.</code></pre>
<h2 class="f4 lh-copy"><a name="java-code" id="java-code">Connect to remote host from java</a></h2>
<p>I have used <a href="http://www.jcraft.com/jsch/">JSch library</a> to establish SSH connection.</p>
<p>The most important part is configuration of <code>com.jcraft.jsch.Session</code> object and adding <code>publickey</code> to the list of <code>PreferredAuthentication</code> options.</p>
<p>Here is the sample code for configuring public key authentication:</p>
<pre class="language-java"><code class="language-java">    <span class="token class-name">JSch</span> jsch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Session</span> session <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> privateKeyPath <span class="token operator">=</span> <span class="token string">"/home/vladimir.stankovic/.ssh/id_rsa"</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        jsch<span class="token punctuation">.</span><span class="token function">addIdentity</span><span class="token punctuation">(</span>privateKeyPath<span class="token punctuation">)</span><span class="token punctuation">;</span>	    
        session <span class="token operator">=</span> jsch<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> host<span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">;</span>
        session<span class="token punctuation">.</span><span class="token function">setConfig</span><span class="token punctuation">(</span><span class="token string">"PreferredAuthentications"</span><span class="token punctuation">,</span> <span class="token string">"publickey,keyboard-interactive,password"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>Properties</span> config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        config<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"StrictHostKeyChecking"</span><span class="token punctuation">,</span> <span class="token string">"no"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        session<span class="token punctuation">.</span><span class="token function">setConfig</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">JSchException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"Failed to create Jsch Session object."</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span></code></pre>
<p>The next step is to connect to the remote host and execute an arbitrary command over SSH:</p>
<pre class="language-java"><code class="language-java">    <span class="token class-name">String</span> command <span class="token operator">=</span> <span class="token string">"echo \"Sit down, relax, mix yourself a drink and enjoy the show...\" &gt;&gt; /tmp/test.out"</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        session<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">openChannel</span><span class="token punctuation">(</span><span class="token string">"exec"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ChannelExec</span><span class="token punctuation">)</span> channel<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setCommand</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ChannelExec</span><span class="token punctuation">)</span> channel<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setPty</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        session<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">JSchException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"Error durring SSH command execution. Command: "</span> <span class="token operator">+</span> command<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span></code></pre>
<h2 class="f4 lh-copy"><a name="source-code" id="source-code">Source code</a></h2>
<p>For a full example, you can check out code from the following <a href="https://github.com/svlada/ssh-public-key-authentication">git repository</a>.</p>


</article>

</section>
<div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://svlada.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

  </main>


<script data-goatcounter="https://svlada.goatcounter.com/count" async="" src="//gc.zgo.at/count.js"></script>


</body></html>