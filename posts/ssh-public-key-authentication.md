---
title: Public key authentication with Java over SSH
description: This article shows how to securely connect (i.e. establish ssh connection) to the remote host from java application.
date: 2015-11-23
tags:
  - java
  - ssh
layout: layouts/post.njk
permalink: "ssh-public-key-authentication/index.html"
---

## Table of contents:
1. <a href="#introduction">Introduction</a>
2. <a href="#generate-key-pair">Generate Key Pair</a>
3. <a href="#copy-public-key-to-remote-host">Copy public key to remote host</a>
4. <a href="#java-code">Connect to remote host from java</a> 
5. <a href="#source-code">Source code</a>

### <a name="introduction" id="introduction">Introduction</a>

This article shows how to securely connect (i.e. establish ssh connection) to the remote host from java application. Also, configuration details for enabling public key authentication and protecting ssh keys will be provided.

Public key authentication enables users to establish an SSH connection without providing (i.e. typing in) explicit password. The immediate benefit is that the password is not transferred over the network, thus preventing the possibility of the password being compromised.

The private key should be stored in the ssh keychain and protected with the encryption passphrase.

### <a name="generate-key-pair" id="generate-key-pair">Generate Key Pair</a>

The first step is to generate a private/public key on the server where your java application will be running.

Private/public key pair can be generated by executing the following command:

```text
ssh-keygen -t rsa
```

Here is the output from my local development box:
```text
vladimir.stankovic@PCSVLADA ~
$ ssh-keygen -t rsa
Generating public/private rsa key pair.
Enter file in which to save the key (/home/vladimir.stankovic/.ssh/id_rsa):
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /home/vladimir.stankovic/.ssh/id_rsa.
Your public key has been saved in /home/vladimir.stankovic/.ssh/id_rsa.pub.
```

Private key is identified as ```id_rsa``` and public key as a ```id_rsa.pub```. 

### <a name="copy-public-key-to-remote-host" id="">Copy public key to remote host</a>

The ```ssh-copy-id``` copies the public key of your default identity (use -i identity_file for other identities) to the remote host.


```text
vladimir.stankovic@PCSVLADA ~
$ ssh-copy-id -i /home/vladimir.stankovic/.ssh/id_rsa root@www.svlada.com
/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed
/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys
root@www.svlada.com's password:
Number of key(s) added: 1
Now try logging into the machine, with:   "ssh 'root@www.svlada.com'"
and check to make sure that only the key(s) you wanted were added.
```

### <a name="java-code" id="java-code">Connect to remote host from java</a>

I have used [JSch library](http://www.jcraft.com/jsch/) to establish SSH connection.

The most important part is configuration of ```com.jcraft.jsch.Session``` object and adding ```publickey``` to the list of ```PreferredAuthentication``` options.

Here is the sample code for configuring public key authentication: 
```java
    JSch jsch = new JSch();
    Session session = null;
    String privateKeyPath = "/home/vladimir.stankovic/.ssh/id_rsa";
    try {
        jsch.addIdentity(privateKeyPath);	    
        session = jsch.getSession(username, host, port);
        session.setConfig("PreferredAuthentications", "publickey,keyboard-interactive,password");
        java.util.Properties config = new java.util.Properties(); 
        config.put("StrictHostKeyChecking", "no");
        session.setConfig(config);
    } catch (JSchException e) {
        throw new RuntimeException("Failed to create Jsch Session object.", e);
    }
```

The next step is to connect to the remote host and execute an arbitrary command over SSH:

```java
    String command = "echo \"Sit down, relax, mix yourself a drink and enjoy the show...\" >> /tmp/test.out";
    try {
        session.connect();
        Channel channel = session.openChannel("exec");
        ((ChannelExec) channel).setCommand(command);
        ((ChannelExec) channel).setPty(false);
        channel.connect();
        channel.disconnect();
        session.disconnect();
    } catch (JSchException e) {
        throw new RuntimeException("Error durring SSH command execution. Command: " + command);
    }
```

### <a name="source-code" id="source-code">Source code</a> 
For a full example, you can check out code from the following [git repository](https://github.com/svlada/ssh-public-key-authentication).
